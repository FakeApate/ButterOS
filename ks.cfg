# Generated by Anaconda 42.27.12
# Generated by pykickstart v3.62
#version=DEVEL

# Keyboard layouts
keyboard --vckeymap=ch --xlayouts='ch'
# System language
lang en_GB.UTF-8

# Network information
network  --hostname=meow

# Use network installation
url --url="https://mirror.init7.net/fedora/fedora/linux/releases/42/Everything/x86_64/os"

repo --name=fedora --baseurl=https://mirror.init7.net/fedora/fedora/linux/releases/42/Everything/x86_64/os/ --cost=10
repo --name=updates --baseurl=https://mirror.init7.net/fedora/fedora/linux/updates/42/Everything/x86_64/ --cost=10
repo --name=rpmfusion-nonfree --metalink=https://mirrors.rpmfusion.org/metalink?repo=nonfree-fedora-42&arch=x86_64 --cost=10
repo --name=rpmfusion-free --metalink=https://mirrors.rpmfusion.org/metalink?repo=free-fedora-42&arch=x86_64 --cost=10
repo --name=1password --baseurl=https://downloads.1password.com/linux/rpm/stable/x86_64 --cost=10
repo --name=extra-repo --baseurl=file:///run/install/repo/extra-repo/ --cost=1

%packages
@^i3-desktop-environment
@admin-tools
@i3-extended
git
feh
zsh
gtk-murrine-engine
dex-autostart
thunar
gnome-keyring-pam
wget2-wget
system-config-printer
xfce-polkit
kitty
picom
polybar
vim-enhanced
1password
1password-cli
flameshot
xsecurelock
slick-greeter
akmod-nvidia
xorg-x11-drv-nvidia-cuda
chrony
BackupPC
screen
nmap

# Optional add-ons
xdg-user-dirs
bash-completion
network-manager-applet

# Cleanup
-autofs
-acpid
-gimp-help
-desktop-backgrounds-basic
-aspell-*
-hplip
-qutebrowser
-alacritty
%end

# Run the Setup Agent on first boot
firstboot --disabled
selinux --enforcing
firewall --enabled --service=mdns
# System timezone
timezone Europe/Zurich --utc

#Root password
rootpw --lock
user --groups=wheel --name=sam --password=$y$j9T$A.4HkHV4cb4muAP/fHsuB.Gk$XTxjjVGlM6zj6c2zBFxdQbZNDi1hYmNYfQpQWpvKGhB --iscrypted --gecos="Sam" --shell=/bin/zsh

#Reboot when finished
reboot


%post
# i3 configuration

# Fix https://bugzilla.redhat.com/show_bug.cgi?id=2240823
cat > /etc/xdg/autostart/xfce-polkit.desktop <<EOF

[Desktop Entry]
Type=Application
Name=xfce-polkit
Exec=/usr/libexec/xfce-polkit
EOF

%end

# Post Installation commands
%post --nochroot
#!/bin/sh

set -x -v
exec 1>/mnt/sysimage/root/kickstart_post.log 2>&1

echo "**************************************"
echo "* Running Post Install Configuration *"
echo "**************************************"

echo "***copying files***"

cp -r /run/install/repo/theme/* /mnt/sysimage/
cp /run/install/repo/firstboot.sh /mnt/sysimage/home/sam
chown sam:sam /mnt/sysimage/home/same/firstboot.sh

echo "***Fix permissions***"
chown -R    root:root \
            /mnt/sysimage/usr/share/themes \
            /mnt/sysimage/usr/share/icons \
            /mnt/sysimage/usr/share/fonts \
            /mnt/sysimage/usr/share/backgrounds \
            /mnt/sysimage/usr/share/plymouth \
            /mnt/sysimage/etc/skel \
            /mnt/sysimage/etc/lightdm \
            /mnt/sysimage/etc/profile.d

find    /mnt/sysimage/usr/share/themes \
        /mnt/sysimage/usr/share/icons \
        /mnt/sysimage/usr/share/fonts \
        /mnt/sysimage/usr/share/backgrounds \
        /mnt/sysimage/usr/share/plymouth \
        /mnt/sysimage/etc/skel \
        /mnt/sysimage/etc/lightdm \
        /mnt/sysimage/etc/profile.d \
        -type d -exec chmod 755 {} +

find    /mnt/sysimage/usr/share/themes \
        /mnt/sysimage/usr/share/icons \
        /mnt/sysimage/usr/share/fonts \
        /mnt/sysimage/usr/share/backgrounds \
        /mnt/sysimage/usr/share/plymouth \
        /mnt/sysimage/etc/skel \
        /mnt/sysimage/etc/lightdm \
        -type f -exec chmod 644 {} +

chmod +x /mnt/sysimage/etc/profile.d/firstboot.sh

%end

%post
        set -x -v
        exec 1>/mnt/sysimage/root/kickstart_post_chroot.log 2>&1
        plymouth-set-default-theme -R catppuccin-mocha
        wget https://code.visualstudio.com/sha/download?build=stable&os=linux-rpm-x64 -O /tmp/code.rpm
        dnf install -y /tmp/code.rpm
%end